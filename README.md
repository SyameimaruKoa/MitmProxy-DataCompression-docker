# mitmproxy Docker 環境

この記事の環境をDockerで再現するためのプロジェクトじゃ。
[mitmproxyを導入してアプリの通信内容を書き換える - Qiita](https://qiita.com/tongari0/items/ffa3297630547c3bb712)

mitmproxyのWebインターフェースである`mitmweb`がコンテナ起動時に自動で立ち上がるようになっとる。

## 使い方

### 1. イメージのビルド

最初に、以下のコマンドでDockerイメージをビルドする。

```bash
docker build -t mitmproxy-env .
```

### 2. コンテナの起動

以下のコマンドでコンテナをバックグラウンドで起動する。

- `8080`番ポートでプロキシが待ち受ける。
- `8081`番ポートでWeb UIが待ち受ける。
- カレントディレクトリがコンテナ内の`/app`にマウントされる。

```bash
docker run -d --rm -p 8080:8080 -p 8081:8081 -v "$(pwd):/app" --name mitm-container mitmproxy-env
```

起動後、ブラウザで `http://127.0.0.1:8081` を開けば、`mitmweb`のUIが表示されるはずじゃ。

### 3. ブラウザの設定

HTTPS通信を復号して中身を見るには、ブラウザの設定が必要じゃ。

1.  **プロキシ設定**:
    - Firefoxなどのブラウザのネットワーク設定を開く。
    - プロキシを「手動」に設定し、HTTPとHTTPSの両方でホストに `127.0.0.1`、ポートに `8080` を指定する。
2.  **証明書のインストール**:
    - プロキシ設定済みのブラウザで `http://mitm.it` にアクセスする。
    - OSのアイコン（Linuxならペンギン）をクリックして、CA証明書をダウンロードする。
    - ブラウザの証明書マネージャーを開き、「認証局証明書」としてダウンロードしたファイルをインポートする。「この認証局によるウェブサイトの識別を信頼する」に必ずチェックを入れること。

### 4. コンテナの停止

コンテナを停止するには以下のコマンドを実行する。

```bash
docker stop mitm-container
```
